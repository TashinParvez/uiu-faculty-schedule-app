<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>UIU Faculty Schedule Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;

            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }

        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
        }

        .container {
            max-width: 900px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin: 30px auto;
        }

        h1 {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            color: #1a3c6d;
            margin-bottom: 30px;
        }

        .input-group {
            position: relative;
            z-index: 1;
        }

        .dropdown-menu {
            width: 100%;
            max-height: 250px;
            overflow-y: auto;
            border-radius: 0 0 10px 10px;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-top: 40px;
            /* tashin */
            z-index: 1000;
        }

        .suggestion-item {
            padding: 12px 15px;
            transition: background 0.2s ease;
        }

        .suggestion-item:hover,
        .suggestion-item.active {
            background-color: #cce0ff;
            /* tashin here */
            /* color: white; */
            cursor: pointer;
        }

        .input-group input:focus {
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            border-color: #007bff;
        }

        .btn-primary {
            background-color: #1a3c6d;
            border-color: #1a3c6d;
            transition: background 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #005cbf;
            border-color: #005cbf;
        }

        #result {
            margin-top: 25px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 10px;
        }

        .highlight {
            font-weight: 600;
            color: #007bff;
        }

        .today-section {
            background: #e6f0fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #007bff;
        }

        .today-section h5 {
            color: #1a3c6d;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .table-responsive {
            margin-bottom: 30px;
        }

        .table th {
            background-color: #1a3c6d;
            color: white;
            font-weight: 600;
        }

        .table td {
            vertical-align: middle;
            font-size: 0.95rem;
        }

        .cell-class {
            background-color: #d1ecf1 !important;
            color: black;
        }

        .cell-cnh {
            background-color: #d4edda !important;
            color: black;
        }

        .cell-oh {
            background-color: #fff3cd !important;
            color: black;
        }

        .cell-free {
            background-color: white !important;
            color: black;
        }

        .faculty-info {
            background: #f1f3f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 20px;
                padding: 20px;
            }

            h1 {
                font-size: 1.6rem;
            }

            .table {
                font-size: 0.85rem;
            }

            .table th,
            .table td {
                padding: 8px;
            }

            /* for phones */
            footer {
                font-size: 12px;
                padding: 10px;
            }
        }

        footer {
            background: #222;
            color: #ddd;
            text-align: center;
            padding: 12px;
            font-size: 14px;
            border-top: 2px solid #444;
        }

        footer p {
            margin: 5px 0;
        }

        footer small {
            font-size: 12px;
            color: #aaa;
        }

        @media (max-width: 576px) {

            /* for phones */
            footer {
                font-size: 12px;
                padding: 10px;
            }
        }
    </style>
</head>

<body>

    <!--================================ Main Seg ================================-->

    <main>
        <div class="container">
            <h1>Faculty Schedule Search</h1>
            <form id="searchForm">
                <div class="input-group mb-3">
                    <input type="text" id="searchInput" class="form-control" placeholder="Enter faculty name or code"
                        autocomplete="off" required>
                    <button type="submit" class="btn btn-primary">Search</button>
                    <div id="suggestions" class="dropdown-menu" style="display: none;"></div>
                </div>
            </form>
            <div id="result"></div>
        </div>
    </main>


    <!--================================ footer ================================-->

    <footer
        style="margin-top:30px; padding:15px; background:#222; color:#ddd; text-align:center; font-size:14px; border-radius:5px 5px 0 0;">
        <p>UIU Faculty Schedule App — Built for UIU Students</p>
        <p>Made with ❤️ by
            <a href="https://github.com/TashinParvez" target="_blank" style="color:#2c80e1; text-decoration:none;">
                <i class="bi bi-github"></i>
                <u>
                    Tashin Parvez
                </u>
            </a>
        </p>

        <p style="font-size:12px; color:#aaa;">Note: Information is based on uploaded data (Summer 2025). Please verify
            with
            faculty/department if necessary.</p>
    </footer>

    <script>
        const searchInput = document.getElementById('searchInput');
        const suggestionsDropdown = document.getElementById('suggestions');
        const resultDiv = document.getElementById('result');
        let facultyData = {};
        let activeIndex = -1;
        const today = new Date().toLocaleString('en-US', { weekday: 'short' }).toUpperCase();

        // Load faculty_data.json
        fetch('./faculty_data.json')
            .then(res => {
                if (!res.ok) throw new Error('Failed to load faculty data');
                return res.json();
            })
            .then(data => facultyData = data)
            .catch(err => {
                console.error('Error loading JSON:', err);
                resultDiv.innerHTML = '<p class="text-danger">Error loading faculty data. Please try again later.</p>';
            });

        function filterSuggestions(query) {
            query = query.toLowerCase();
            return Object.entries(facultyData)
                .filter(([code, f]) => f.name.toLowerCase().includes(query) || code.toLowerCase().includes(query))
                .map(([code, f]) => ({ name: f.name, code }))
                .slice(0, 5);
        }

        function showSuggestions(suggestions) {
            suggestionsDropdown.innerHTML = '';
            if (suggestions.length === 0) {
                suggestionsDropdown.style.display = 'none';
                return;
            }

            suggestions.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'dropdown-item suggestion-item';
                div.innerHTML = `<span class="highlight">${item.name}</span> (${item.code})`;
                div.addEventListener('click', () => selectFaculty(item.code));
                suggestionsDropdown.appendChild(div);
            });
            suggestionsDropdown.style.display = 'block';
        }

        function selectFaculty(code) {
            const faculty = facultyData[code];
            if (!faculty) return;
            searchInput.value = faculty.name;
            suggestionsDropdown.style.display = 'none';
            showResult(faculty, code);
        }

        function getCellClass(value) {
            if (!value || value.trim() === '') return 'cell-free';
            if (value.includes('CnH')) return 'cell-cnh';
            if (value === 'OH') return 'cell-oh';
            return 'cell-class';
        }

        function buildTable(schedule, times, isUndergrad = true) {
            if (!schedule || Object.keys(schedule).length === 0) {
                return `<p class="text-muted">No ${isUndergrad ? 'undergraduate' : 'graduate'} schedule available.</p>`;
            }

            const days = Object.keys(schedule).sort((a, b) => {
                const dayOrder = ['SAT', 'SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI'];
                return dayOrder.indexOf(a) - dayOrder.indexOf(b);
            });

            let table = '<table class="table table-bordered table-hover"><thead><tr><th>Day</th>';
            times.forEach(t => table += `<th>${t}</th>`);
            table += '</tr></thead><tbody>';

            days.forEach(day => {
                const highlight = day === today ? 'class="table-warning"' : '';
                table += `<tr ${highlight}><td>${day}</td>`;
                schedule[day].forEach(value => {
                    const cellClass = getCellClass(value);
                    table += `<td class="${cellClass}">${value || 'Free'}</td>`;
                });
                table += '</tr>';
            });

            table += '</tbody></table>';
            return table;
        }

        function buildTodaySchedule(faculty) {
            let todayHtml = '<div class="today-section"><h5>Today\'s Schedule (' + today + ')</h5>';

            if (faculty.undergrad && faculty.undergrad.schedule[today]) {
                todayHtml += '<h6>Undergraduate</h6><ul class="list-group mb-3">';
                faculty.undergrad.times.forEach((time, i) => {
                    const activity = faculty.undergrad.schedule[today][i] || 'Free';
                    const cellClass = getCellClass(activity);
                    todayHtml += `<li class="list-group-item ${cellClass}">${time}: ${activity}</li>`;
                });
                todayHtml += '</ul>';
            } else {
                todayHtml += '<p class="text-muted">No undergraduate schedule for today.</p>';
            }

            if (faculty.grad && faculty.grad.schedule[today]) {
                todayHtml += '<h6>Graduate</h6><ul class="list-group mb-3">';
                faculty.grad.times.forEach((time, i) => {
                    const activity = faculty.grad.schedule[today][i] || 'Free';
                    const cellClass = getCellClass(activity);
                    todayHtml += `<li class="list-group-item ${cellClass}">${time}: ${activity}</li>`;
                });
                todayHtml += '</ul>';
            } else {
                todayHtml += '<p class="text-muted">No graduate schedule for today.</p>';
            }

            todayHtml += '</div>';
            return todayHtml;
        }

        function showResult(faculty, code) {
            const undergradTable = buildTable(faculty.undergrad.schedule, faculty.undergrad.times);
            const gradTable = buildTable(faculty.grad.schedule, faculty.grad.times, false);
            const todaySchedule = buildTodaySchedule(faculty);

            resultDiv.innerHTML = `
                <div class="faculty-info">
                    

                    <h3 class="mb-3" style="color:#1a3c6d; font-weight:bold;">
  ${faculty.name} (${code})
</h3>

                    <p class="mb-2"><strong>Designation:</strong> ${faculty.designation}</p>
                    <p class="mb-2"><strong>Room:</strong> ${faculty.room}</p>
                    <p class="mb-0"><strong>Email:</strong> ${faculty.email}</p>
                </div>
                ${todaySchedule}
                <h6 class="mb-3">Full Undergraduate Schedule</h6>
                <div class="table-responsive">${undergradTable}</div>
                <h6 class="mb-3">Full Graduate Schedule</h6>
                <div class="table-responsive">${gradTable}</div>
            `;
        }

        searchInput.addEventListener('input', () => {
            activeIndex = -1;
            const query = searchInput.value.trim();
            if (!query) {
                suggestionsDropdown.style.display = 'none';
                return;
            }
            showSuggestions(filterSuggestions(query));
        });

        searchInput.addEventListener('keydown', (e) => {
            const items = suggestionsDropdown.querySelectorAll('.suggestion-item');
            if (e.key === 'ArrowDown') {
                activeIndex = (activeIndex + 1) % items.length;
                updateActive(items);
                e.preventDefault();
            } else if (e.key === 'ArrowUp') {
                activeIndex = (activeIndex - 1 + items.length) % items.length;
                updateActive(items);
                e.preventDefault();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (activeIndex >= 0) {
                    selectFaculty(filterSuggestions(searchInput.value.trim())[activeIndex].code);
                } else {
                    const query = searchInput.value.trim();
                    const bestMatch = Object.entries(facultyData)
                        .find(([code, f]) => f.name.toLowerCase().startsWith(query.toLowerCase()) || code.toLowerCase().startsWith(query.toLowerCase()));
                    if (bestMatch) selectFaculty(bestMatch[0]);
                    else resultDiv.innerHTML = '<p class="text-danger">Faculty not found.</p>';
                }
            }
        });

        function updateActive(items) {
            items.forEach((item, i) => item.classList.toggle('active', i === activeIndex));
        }

        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !suggestionsDropdown.contains(e.target)) {
                suggestionsDropdown.style.display = 'none';
            }
        });

        document.getElementById('searchForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (!query) return;
            const bestMatch = Object.entries(facultyData)
                .find(([code, f]) => f.name.toLowerCase().startsWith(query.toLowerCase()) || code.toLowerCase().startsWith(query.toLowerCase()));
            if (bestMatch) selectFaculty(bestMatch[0]);
            else resultDiv.innerHTML = '<p class="text-danger">Faculty not found.</p>';
        });
    </script>
</body>

</html>